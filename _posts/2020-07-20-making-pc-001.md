---
title: 8ビットパソコンを作る (1)
author: Kazumasa
layout: post
tags: [Z80, AKI-80, ROM エミュレータ]
description: Building a PC with Z80
---

自分でパソコンを作ってみたくなった。とはいってもいわゆる自作PCではなく、8ビットのパソコンだ。自作PCはパーツの中身に使われている技術が高度すぎて詳細を把握できない。でも30年前の8ビットコンピュータならそこまで難しくはない。とはいえ、そんなに簡単ではないし、そもそも今どきなんの役にも立たないのだが、自作PCを組み立てるよりは満足度が高いのではないか。

まず、仕様を考える。秋月電子のAKI-80ゴールドボードを中心にシステムを作ることにしよう。AKI-80ゴールドボードは東芝のTMPZ84C015BF-12をCPUとして使用している。TMPZ84C015BF-12はかつて市販されていた8ビットパソコンでよく採用されていたザイログ社のZ80 CPUとソフトウェア互換があり、動作クロックは最大12MHzだ。30年前のZ80は4MHzが普通だったので、その3倍で動作する。また、Z80 CPUと同時に使われるいくつかのICの機能を内蔵している。ただ、TMPZ84C015BF-12という型番は馴染みが薄いので、これからはZ80として取り扱うことにする。

Z80のメモリアドレス空間は64KiBであるが、AKI-80には32KiBのSRAMが搭載されており、残りの32KiBの空間はROMが使用するようになっている。ROMとしては2764(8KiB)、27128(16KiB)、27256(32KiB)が使えるが、古いタイプのEPROMということもあって、入手が面倒だ。また、プログラムを修正するたびにROMをAKI-80から取り外し、特別な装置を使って中身を書き替える必要が有る。これでは効率が悪いのでROMエミュレータを作ることにする。ROMエミュレータは本来ROM配置されているアドレス空間にSRAMを接続しておき、電源が入るとプログラムをSRAMの中に転送してCPUを起動する回路だ。

ROMエミュレータ用の秋月電子通商でSRAMを探してみると256Kビット(32KiB)のものと1Mビット(128KiB)のものがある。AKI-80のROM用の空間は32KiBなので256Kビットのもので十分で、1Mビットのものは過剰である。ただし使いみちがないわけではなく、バンク切り替えという方法を使って利用することができる。メモリの割当を図示すると下図のようになる。

![Memory Map](/assets/images/memory_map.png)

ROMエミュレータのSRAMを4等分して32KiBの4枚のページにし、同じアドレスに配置してある。同じアドレスに配置してあるSRAMは同時に使うことはできないが、バンク切り分け回路を使えば切り替えて有効利用することができる。

ROMのイメージはSDカードに格納するようにする。ただ、たかだか32KiB程度のイメージを保管するためだけにSDカードを使用するのはもったいない。そこでSDカードを外部記憶装置として使えるようにしておく。

ROMエミュレータは、ROMソケットに差し込む形になっているものが多いが、今回はバックプレーン基板を準備し、バックプレーン基板を経由してAKI-80と接続する。ROMエミュレータとしては少し変わった形かもしれないが、外部記憶装置を兼ねていることを考えれば、それほどおかしなものではない。

バックプレーン基板はPCB基板で作成する。近頃は100mm×100mmまでのサイズであれば、格安で基板を作成してくれる業者がいくつか有るので、バックプレーン基板のサイズはこのサイズに抑える。バックプレーンに挿す基板同士を15mmのスペーサを挟んで固定できるように、バックプレーン基板に挿す基板と基板の間隔は15mmとする。基板の厚みを1.6mmとすると16.6mmの周期でコネクタを配置することになる。100÷16.6≒6なので最大6枚配置できそうだ。CPU基板とROMエミュレータを載せたとしても最大4枚分のコネクタが残る。ここにはRAMを追加してメモリをもっと増やすこともできるし、機能拡張用の基板を取り付けることもできるだろう。

入出力にはUSBキーボードとテレビを使う。USBキーボードはPICマイコンを使えばシリアル信号へ変換できる。難しいのはテレビ出力の方だが、モノクロのNTSC信号であればマイコンを使った製作例が有るので、なんとかなるだろう。

ソフトウェアの方はZ80と互換性が有るので、OSにはCP/Mが使えるはずだ。これで、カラー表示や文字以外のグラフィック表示はできないがパソコンとしての体裁は整う。まずはここをゴールにしよう。

パソコンの名前は、*Retro 8*とする。特に工夫のない名前だが、古い技術を楽しむための8ビットパソコンなので、これで良しとする。
