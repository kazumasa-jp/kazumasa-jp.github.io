---
title: 8ビットパソコンを作る (2)
author: Kazumasa
layout: post
tags: [Z80, AKI-80]
description: Building a PC with Z80
---

もう少し、全体像を詰めておこう。

Retro 8は数枚のPCB基板で構成されるが、PCB基板の価格を考えると、すべての基板は100mm×100mmのサイズに抑えなければならない。Retro 8を構成する要素は、
1. AKI-80
2. バックプレーン
3. ROMエミュレータ
4. ビデオインターフェース
5. キーボードインターフェース

の5つであるが、この中で基板サイズの影響を最も受けるのはバックプレーンだろう。基板のサイズが大きければ、それだけ拡張性が高まる。そこでバックプレーンのサイズを100mm×100mmとし、バックプレーンの仕様を考えよう。

基板接続コネクタの周期は16.6mmなので6個配置できそうだが、電源回路を載せるスペースを確保するため、一つ減らしてコネクタは5つとする。5つのコネクタのうち、1つはAKI-80を接続するためのコネクタであり、残りの4つが拡張基板用のコネクタになる。AKI-80を接続するコネクタをCPUコネクタ、残りのコネクタを拡張コネクタと呼ぶことにする。

バックプレーン基板には、コネクタと電源回路だけではなく、CPUがどの拡張コネクタにアクセスするか示す回路やメモリバンク切り替え用の回路も載せておきたい。仮に4つの拡張コネクタをすべてメモリの拡張に使用した場合、128KiB×4+32KiB=544KiBのメモリが使用できることになる。メモリマップは下図のようになる。

![メモリマップ](/assets/images/memory_map2.png)

コネクタ選択回路やバンク切り替え回路にはZ80のI/Oポートを使ってアクセスする。AKI-80のCPUであるTMPZ84C015BFは、シリアル通信回路などの周辺回路が内蔵されているため、これらの内蔵回路用にすでにいくつかのI/Oアドレスを使用している。これらと重複しないようにバンク切り替え回路とコネクタ選択用の回路のI/Oアドレスは、0x20以降に設定する。

| I/O アドレス | 内部回路 | 機能                                  |
|--------------|----------|---------------------------------------|
|         0x10 | CTC      | チャネル0                             |
|         0x11 |          | チャネル1                             |
|         0x12 |          | チャネル2                             |
|         0x13 |          | チャネル3                             |
|         0x18 | SIO      | チャネルA 送信/受信バッファ           |
|         0x19 |          | チャネルA コマンド/ステータスレジスタ |
|         0x1A |          | チャネルB 送信/受信バッファ           |
|         0x1B |          | チャネルB コマンド/ステータスレジスタ |
|         0x1C | PIO      | ポートA データ                        |
|         0x1D |          | ポートA コマンド                      |
|         0x1E |          | ポートB データ                        |
|         0x1F |          | ポートB コマンド                      |
|         0xF0 | WDT      | モード設定                            |
|         0xF1 |          | コマンド                              |
|         0xF4 |          | 割り込み優先順位設定                  |

